<launch>

    <!-- Set sim time if not using camera -->
    <param name="/use_sim_time" value="true"/>
    <!--
    <node pkg="image_transport" 
		  type="republish" 
		  name="realsense_rgb" 
		  args="compressed in:=/realsense/color/image_raw
		  		raw out:=/realsense/color/image_raw"/> 
	
    <node pkg="image_transport" 
		  type="republish" 
		  name="realsense_depth" 
		  args="compressedDepth in:=/realsense/aligned_depth_to_color/image_raw
		        raw out:=/realsense/aligned_depth_to_color/image_raw"/> -->

    <!--IMU Filter Madgwick
    <node pkg="imu_filter_madgwick" type="imu_filter_node" name="ImuFilter">
        <param name="use_mag" value="true" />
        <param name="publish_tf" type="bool" value="false" />
        <param name="world_frame" type="string" value="enu" />
        <remap from="/imu/data_raw" to="/imu/data" />
    </node>-->


    <include file="$(find rtabmap_ros)/launch/rtabmap.launch">
        <arg name="depth"  value="true"/>
        <arg name="args" value="--delete_db_on_start --Optimizer/GravitySigma 0.3"/>
        <arg name="rgb_topic" value="/realsense/color/image_raw"/>
        
        <arg name="depth_topic" default="/realsense/aligned_depth_to_color/image_raw" />
        
        <arg name="camera_info_topic" value="/realsense/color/camera_info"/>
        <arg name="depth_camera_info_topic" default="/realsense/aligned_depth_to_color/camera_info" />
        <param name="depth_image_topic" value="/realsense/aligned_depth_to_color/image_raw" />
        
        <arg name="visual_odometry" value="false"/>
        <arg name="icp_odometry" default="false"/>

        <arg name="rtabmapviz" value="false"/>
        <arg name="rviz" value="true"/>
        <arg name="frame_id" value="base_link"/>

        <!--<arg name="subscribe_rgbd" value="true"/>-->
        
        <arg name="scan_cloud_topic" value="/livox/lidar"/>

        <arg name="compressed" default="true"/>

        <arg name="approx_sync" value="true"/>
        <arg name="approx_sync_max_interval"  default="0"/>

        <arg name="odom_topic" value="odometry/filtered"/>
        <param name="Odom/ResetCountdown" value="1"/>

        <!-- Dont use GPS here!-->
        <arg name="gps_topic" default="/mimix3/gps/assisted" /> 
        <param name="publish_null_when_lost" value="false"/>
        <param name="Odom/ResetCountdown" value="1"/>
    </include>

    <include file="$(find fruc_dataset_apparatus_slam)/launch/mars_localization.launch" />

    <include file="$(find fruc_dataset_apparatus_slam)/launch/robot_localization.launch" />

    <!-- ROBOT LOCALIZATION
    <include file="$(find robot_localization)/launch/ukf_template.launch" />

    <param name="/ukf_se/frequency" value="30" />
    <param name="/ukf_se/base_link_frame" value="base_link" />
    
    <param name="/ukf_se/odom0" value="rtabmap/odom" />
    

    
    <rosparam param="/ukf_se/odom0_config">[true,true,true,
                                            true,true,true,
                                            true,true,true,
                                            true,true,true,
                                            false,false,false]
    </rosparam>
    <param name="/ukf_se/odom0_relative" value="false"/>
    <param name="/ukf_se/odom0_differential" value="false"/>
    
    
    <param name="/ukf_se/imu0" value="/imu/data"/>
    <rosparam param="/ukf_se/imu0_config">[false, false, false,
                                            true, true, true,
                                            false, false, false,
                                            true, true, true,
                                            true, true, true]</rosparam>
    <param name="/ukf_se/imu0_differential" value="false"/>
    <param name="/ukf_se/imu0_relative" value="false"/>-->


</launch>